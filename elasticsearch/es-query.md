- [ğŸ§± 1. Top-level Query Clauseë€?](#-1-top-level-query-clauseë€)
- [Top-level Query Clauses â€” ì „ì²´ ëª©ë¡ê³¼ ì„¤ëª…](#top-level-query-clauses--ì „ì²´-ëª©ë¡ê³¼-ì„¤ëª…)
  - [1. match](#1-match)
  - [2. match\_phrase](#2-match_phrase)
  - [3. term](#3-term)
  - [4. terms](#4-terms)
  - [5. range](#5-range)
  - [6. bool](#6-bool)
  - [7. constant\_score](#7-constant_score)
  - [8. function\_score](#8-function_score)
  - [9. script\_score](#9-script_score)
  - [10. match\_all](#10-match_all)
  - [11. match\_none](#11-match_none)
  - [12. exists](#12-exists)
  - [13. prefix](#13-prefix)
  - [14. wildcard](#14-wildcard)
  - [15. fuzzy](#15-fuzzy)
  - [16. multi\_match](#16-multi_match)
  - [17. dis\_max](#17-dis_max)
  - [18. query\_string](#18-query_string)
  - [19. simple\_query\_string](#19-simple_query_string)
- [FAQ](#faq)
  - [How gauss makes scores?](#how-gauss-makes-scores)
    - [ê°€ìš°ì‹œì•ˆ í•¨ìˆ˜ì˜ ìˆ˜ì‹](#ê°€ìš°ì‹œì•ˆ-í•¨ìˆ˜ì˜-ìˆ˜ì‹)
    - [ë§¤ê°œë³€ìˆ˜ ì„¤ëª…](#ë§¤ê°œë³€ìˆ˜-ì„¤ëª…)
    - [ì‹¤ì œ ê³„ì‚° ì˜ˆì‹œ](#ì‹¤ì œ-ê³„ì‚°-ì˜ˆì‹œ)
    - [ì‹œê°ì  ê·¸ë˜í”„](#ì‹œê°ì -ê·¸ë˜í”„)
  - [match\_all is mandatory of script\_score?](#match_all-is-mandatory-of-script_score)
    - [ì˜¤ë¥˜ ë°œìƒ ì˜ˆì‹œ](#ì˜¤ë¥˜-ë°œìƒ-ì˜ˆì‹œ)
    - [script\_scoreì˜ ë™ì‘ ì›ë¦¬](#script_scoreì˜-ë™ì‘-ì›ë¦¬)
    - [ë‹¤ë¥¸ query ì˜ˆì‹œë“¤](#ë‹¤ë¥¸-query-ì˜ˆì‹œë“¤)
      - [íŠ¹ì • ì¡°ê±´ ë¬¸ì„œë§Œ ì ìˆ˜ ê³„ì‚°](#íŠ¹ì •-ì¡°ê±´-ë¬¸ì„œë§Œ-ì ìˆ˜-ê³„ì‚°)
      - [ë³µí•© ì¡°ê±´](#ë³µí•©-ì¡°ê±´)
  - [How boost\_mode makes scores?](#how-boost_mode-makes-scores)
    - [function\_score ì ìˆ˜ ê³„ì‚° ê³¼ì •](#function_score-ì ìˆ˜-ê³„ì‚°-ê³¼ì •)
    - [boost\_mode ì˜µì…˜ë“¤](#boost_mode-ì˜µì…˜ë“¤)
      - [1. `multiply` (ì˜ˆì œì—ì„œ ì‚¬ìš©)](#1-multiply-ì˜ˆì œì—ì„œ-ì‚¬ìš©)
      - [2. `sum`](#2-sum)
      - [3. `avg`](#3-avg)
      - [4. `max`](#4-max)
      - [5. `min`](#5-min)
      - [6. `replace`](#6-replace)
    - [êµ¬ì²´ì ì¸ ê³„ì‚° ì˜ˆì‹œ](#êµ¬ì²´ì ì¸-ê³„ì‚°-ì˜ˆì‹œ)
    - [boost\_modeë³„ ê²°ê³¼ ë¹„êµ](#boost_modeë³„-ê²°ê³¼-ë¹„êµ)
  - [function\_score vs script\_score?](#function_score-vs-script_score)
    - [ì£¼ìš” ì°¨ì´ì ](#ì£¼ìš”-ì°¨ì´ì )
    - [1. function\_score - êµ¬ì¡°í™”ëœ ì ‘ê·¼](#1-function_score---êµ¬ì¡°í™”ëœ-ì ‘ê·¼)
    - [2. script\_score - ììœ ë¡œìš´ ë¡œì§](#2-script_score---ììœ ë¡œìš´-ë¡œì§)
    - [ì–¸ì œ ì–´ë–¤ ê²ƒì„ ì‚¬ìš©í• ê¹Œ?](#ì–¸ì œ-ì–´ë–¤-ê²ƒì„-ì‚¬ìš©í• ê¹Œ)
      - [function\_score ì‚¬ìš© ê¶Œì¥](#function_score-ì‚¬ìš©-ê¶Œì¥)
      - [script\_score ì‚¬ìš© ê¶Œì¥](#script_score-ì‚¬ìš©-ê¶Œì¥)
    - [ì„±ëŠ¥ ë¹„êµ](#ì„±ëŠ¥-ë¹„êµ)
  - [How tie\_breaker makes scores?](#how-tie_breaker-makes-scores)
    - [dis\_maxì˜ ê¸°ë³¸ ë™ì‘](#dis_maxì˜-ê¸°ë³¸-ë™ì‘)
    - [tie\_breakerì˜ ì—­í• ](#tie_breakerì˜-ì—­í• )
    - [ê³„ì‚° ê³µì‹](#ê³„ì‚°-ê³µì‹)
      - [ì˜ˆì œ ê³„ì‚°](#ì˜ˆì œ-ê³„ì‚°)
    - [tie\_breaker ê°’ì— ë”°ë¥¸ ì°¨ì´](#tie_breaker-ê°’ì—-ë”°ë¥¸-ì°¨ì´)
    - [ì‹¤ì œ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤](#ì‹¤ì œ-ì‚¬ìš©-ì‹œë‚˜ë¦¬ì˜¤)
      - [1. ì œëª© ìš°ì„ , ë³¸ë¬¸ ë³´ì¡° ê³ ë ¤](#1-ì œëª©-ìš°ì„ -ë³¸ë¬¸-ë³´ì¡°-ê³ ë ¤)
      - [2. ì—¬ëŸ¬ í•„ë“œ ê²€ìƒ‰ì—ì„œ ê· í˜• ì¡°ì •](#2-ì—¬ëŸ¬-í•„ë“œ-ê²€ìƒ‰ì—ì„œ-ê· í˜•-ì¡°ì •)
    - [tie\_breaker vs bool should ë¹„êµ](#tie_breaker-vs-bool-should-ë¹„êµ)
      - [dis\_max (tie\_breaker=0.3)](#dis_max-tie_breaker03)
      - [bool should](#bool-should)
- [í˜„ì‹¤ì ì¸ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì‹¤ìŠµ ì˜ˆì œ](#í˜„ì‹¤ì ì¸-ì‹œë‚˜ë¦¬ì˜¤ë¥¼-ê¸°ë°˜ìœ¼ë¡œ-í•œ-ì‹¤ìŠµ-ì˜ˆì œ)
  - [1. `match` â€“ ì‚¬ìš©ìê°€ ì…ë ¥í•œ ê²€ìƒ‰ì–´ë¡œ ë¸”ë¡œê·¸ ì œëª© ì°¾ê¸°](#1-match--ì‚¬ìš©ìê°€-ì…ë ¥í•œ-ê²€ìƒ‰ì–´ë¡œ-ë¸”ë¡œê·¸-ì œëª©-ì°¾ê¸°)
  - [2. `term` â€“ íŠ¹ì • ìƒíƒœì¸ ìƒí’ˆ ê²€ìƒ‰](#2-term--íŠ¹ì •-ìƒíƒœì¸-ìƒí’ˆ-ê²€ìƒ‰)
  - [3. `terms` â€“ íŠ¹ì • ì¹´í…Œê³ ë¦¬ì— ì†í•œ ê²Œì‹œë¬¼ë“¤ ì°¾ê¸°](#3-terms--íŠ¹ì •-ì¹´í…Œê³ ë¦¬ì—-ì†í•œ-ê²Œì‹œë¬¼ë“¤-ì°¾ê¸°)
  - [4. `range` â€“ íŠ¹ì • ê°€ê²©ëŒ€ ìƒí’ˆ ê²€ìƒ‰](#4-range--íŠ¹ì •-ê°€ê²©ëŒ€-ìƒí’ˆ-ê²€ìƒ‰)
  - [5. `bool` â€“ ì—¬ëŸ¬ ì¡°ê±´ì„ ì¡°í•©](#5-bool--ì—¬ëŸ¬-ì¡°ê±´ì„-ì¡°í•©)
  - [6. `constant_score` â€“ ì ìˆ˜ ë¬´ì‹œí•˜ê³  ë‹¨ìˆœ í•„í„°](#6-constant_score--ì ìˆ˜-ë¬´ì‹œí•˜ê³ -ë‹¨ìˆœ-í•„í„°)
  - [7. `function_score` â€“ ìµœê·¼ ì ‘ì† ì‹œê°„ê³¼ í™œë™ ì ìˆ˜ë¡œ ì‚¬ìš©ì ìˆœìœ„ ê²°ì •](#7-function_score--ìµœê·¼-ì ‘ì†-ì‹œê°„ê³¼-í™œë™-ì ìˆ˜ë¡œ-ì‚¬ìš©ì-ìˆœìœ„-ê²°ì •)
  - [8. `script_score` â€“ ì‚¬ìš©ì ë§ì¶¤ ì ìˆ˜ ê³„ì‚°](#8-script_score--ì‚¬ìš©ì-ë§ì¶¤-ì ìˆ˜-ê³„ì‚°)
  - [9. `match_phrase` â€“ ì •í™•í•œ ë¬¸ì¥ í¬í•¨ ê²€ìƒ‰](#9-match_phrase--ì •í™•í•œ-ë¬¸ì¥-í¬í•¨-ê²€ìƒ‰)
  - [10. `exists` â€“ íŠ¹ì • í•„ë“œê°€ ì¡´ì¬í•˜ëŠ” ë¬¸ì„œë§Œ í•„í„°ë§](#10-exists--íŠ¹ì •-í•„ë“œê°€-ì¡´ì¬í•˜ëŠ”-ë¬¸ì„œë§Œ-í•„í„°ë§)
  - [11. `prefix` â€“ ë¬¸ìì—´ ì‹œì‘ ì¡°ê±´ ê²€ìƒ‰](#11-prefix--ë¬¸ìì—´-ì‹œì‘-ì¡°ê±´-ê²€ìƒ‰)
  - [12. `wildcard` â€“ ìœ ì—°í•œ íŒ¨í„´ ê²€ìƒ‰](#12-wildcard--ìœ ì—°í•œ-íŒ¨í„´-ê²€ìƒ‰)
  - [13. `fuzzy` â€“ ì˜¤íƒ€ í—ˆìš© ê²€ìƒ‰](#13-fuzzy--ì˜¤íƒ€-í—ˆìš©-ê²€ìƒ‰)
  - [14. `multi_match` â€“ ì—¬ëŸ¬ í•„ë“œì—ì„œ í‚¤ì›Œë“œ ê²€ìƒ‰](#14-multi_match--ì—¬ëŸ¬-í•„ë“œì—ì„œ-í‚¤ì›Œë“œ-ê²€ìƒ‰)
  - [15. `dis_max` â€“ ì—¬ëŸ¬ ì¿¼ë¦¬ ì¤‘ ìµœê³  ì ìˆ˜ë§Œ ì‚¬ìš©](#15-dis_max--ì—¬ëŸ¬-ì¿¼ë¦¬-ì¤‘-ìµœê³ -ì ìˆ˜ë§Œ-ì‚¬ìš©)
  - [16. `query_string` â€“ ë³µì¡í•œ ìˆ˜ì‹ ê²€ìƒ‰](#16-query_string--ë³µì¡í•œ-ìˆ˜ì‹-ê²€ìƒ‰)
  - [17. `simple_query_string` â€“ ì•ˆì „í•œ ìˆ˜ì‹ ê²€ìƒ‰](#17-simple_query_string--ì•ˆì „í•œ-ìˆ˜ì‹-ê²€ìƒ‰)
  - [18. `match_all` â€“ ì „ì²´ ë¬¸ì„œ ì¡°íšŒ](#18-match_all--ì „ì²´-ë¬¸ì„œ-ì¡°íšŒ)
  - [19. `match_none` â€“ ì¡°ê±´ì— ë”°ë¼ ê²°ê³¼ê°€ ì—†ì–´ì•¼ í•˜ëŠ” ê²½ìš°](#19-match_none--ì¡°ê±´ì—-ë”°ë¼-ê²°ê³¼ê°€-ì—†ì–´ì•¼-í•˜ëŠ”-ê²½ìš°)
- [ì¢€ë” ë³µì¡í•œ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì‹¤ìŠµ ì˜ˆì œ](#ì¢€ë”-ë³µì¡í•œ-ì‹œë‚˜ë¦¬ì˜¤ë¥¼-ê¸°ë°˜ìœ¼ë¡œ-í•œ-ì‹¤ìŠµ-ì˜ˆì œ)
  - [ì‹œë‚˜ë¦¬ì˜¤ 1: ì‚¬ìš©ìì˜ ì„ í˜¸ ì¥ë¥´ ê¸°ë°˜ ì˜í™” ì¶”ì²œ](#ì‹œë‚˜ë¦¬ì˜¤-1-ì‚¬ìš©ìì˜-ì„ í˜¸-ì¥ë¥´-ê¸°ë°˜-ì˜í™”-ì¶”ì²œ)
    - [1-1. ê¸°ë³¸ terms í•„í„°ë§](#1-1-ê¸°ë³¸-terms-í•„í„°ë§)
    - [1-2. genre + ìµœì‹  ê°œë´‰ì¼ ìˆœ ì •ë ¬](#1-2-genre--ìµœì‹ -ê°œë´‰ì¼-ìˆœ-ì •ë ¬)
    - [1-3. genre í•„í„° + í‰ì  ê¸°ë°˜ ê°€ì¤‘ì¹˜ ë¶€ì—¬](#1-3-genre-í•„í„°--í‰ì -ê¸°ë°˜-ê°€ì¤‘ì¹˜-ë¶€ì—¬)
  - [## ì‹œë‚˜ë¦¬ì˜¤ 2: ì‚¬ìš©ì ìœ„ì¹˜ ê¸°ë°˜ ê·¼ì²˜ ì´ë²¤íŠ¸ ì¶”ì²œ](#-ì‹œë‚˜ë¦¬ì˜¤-2-ì‚¬ìš©ì-ìœ„ì¹˜-ê¸°ë°˜-ê·¼ì²˜-ì´ë²¤íŠ¸-ì¶”ì²œ)
    - [### 2-1. ë°˜ê²½ 10km ì´ë²¤íŠ¸ í•„í„°](#-2-1-ë°˜ê²½-10km-ì´ë²¤íŠ¸-í•„í„°)
    - [### 2-2. ê°€ê¹Œìš´ ê±°ë¦¬ì¼ìˆ˜ë¡ ë†’ì€ ì ìˆ˜ (gauss ì‚¬ìš©)](#-2-2-ê°€ê¹Œìš´-ê±°ë¦¬ì¼ìˆ˜ë¡-ë†’ì€-ì ìˆ˜-gauss-ì‚¬ìš©)
    - [### 2-3. ê±°ë¦¬ + ì¸ê¸° ì ìˆ˜ ì¡°í•©](#-2-3-ê±°ë¦¬--ì¸ê¸°-ì ìˆ˜-ì¡°í•©)
  - [## ì‹œë‚˜ë¦¬ì˜¤ 3: ìµœê·¼ ì ‘ì† ì‚¬ìš©ì ìš°ì„  ì¶”ì²œ](#-ì‹œë‚˜ë¦¬ì˜¤-3-ìµœê·¼-ì ‘ì†-ì‚¬ìš©ì-ìš°ì„ -ì¶”ì²œ)
    - [### 3-1. ìµœê·¼ 7ì¼ ë‚´ ì ‘ì† í•„í„°](#-3-1-ìµœê·¼-7ì¼-ë‚´-ì ‘ì†-í•„í„°)
    - [### 3-2. ìµœê·¼ ì ‘ì†ì¼ì´ ê°€ê¹Œìš¸ìˆ˜ë¡ ì ìˆ˜ ë†’ì„ (gauss)](#-3-2-ìµœê·¼-ì ‘ì†ì¼ì´-ê°€ê¹Œìš¸ìˆ˜ë¡-ì ìˆ˜-ë†’ì„-gauss)
    - [### 3-3. ìµœê·¼ ì ‘ì† + í™œë™ì ìˆ˜ ì¡°í•©](#-3-3-ìµœê·¼-ì ‘ì†--í™œë™ì ìˆ˜-ì¡°í•©)
  - [## ì‹œë‚˜ë¦¬ì˜¤ 4: í™œë™ ì ìˆ˜ ê¸°ë°˜ ì •ë ¬](#-ì‹œë‚˜ë¦¬ì˜¤-4-í™œë™-ì ìˆ˜-ê¸°ë°˜-ì •ë ¬)
    - [### 4-1. ë‹¨ìˆœí•œ `activity_score` ê¸°ì¤€ ì •ë ¬](#-4-1-ë‹¨ìˆœí•œ-activity_score-ê¸°ì¤€-ì •ë ¬)
    - [### 4-2. ì ìˆ˜ ì—†ì„ ê²½ìš° ê¸°ë³¸ê°’ ë¶€ì—¬](#-4-2-ì ìˆ˜-ì—†ì„-ê²½ìš°-ê¸°ë³¸ê°’-ë¶€ì—¬)
    - [### 4-3. í™œë™ ì ìˆ˜ + í‰íŒ ì ìˆ˜ ìŠ¤í¬ë¦½íŠ¸ ê¸°ë°˜ ì¡°í•©](#-4-3-í™œë™-ì ìˆ˜--í‰íŒ-ì ìˆ˜-ìŠ¤í¬ë¦½íŠ¸-ê¸°ë°˜-ì¡°í•©)
  - [## ì‹œë‚˜ë¦¬ì˜¤ 5: ì‚¬ìš©ì íƒœê·¸ì™€ ì•„ì´í…œ íƒœê·¸ ë§¤ì¹­](#-ì‹œë‚˜ë¦¬ì˜¤-5-ì‚¬ìš©ì-íƒœê·¸ì™€-ì•„ì´í…œ-íƒœê·¸-ë§¤ì¹­)
    - [### 5-1. ì‚¬ìš©ì ì„ í˜¸ íƒœê·¸ì™€ ì¼ì¹˜í•˜ëŠ” íƒœê·¸ ê²€ìƒ‰](#-5-1-ì‚¬ìš©ì-ì„ í˜¸-íƒœê·¸ì™€-ì¼ì¹˜í•˜ëŠ”-íƒœê·¸-ê²€ìƒ‰)
    - [### 5-2. ì¼ì¹˜ ê°œìˆ˜ì— ë”°ë¼ ì ìˆ˜ ì¦ê°€ (ìŠ¤í¬ë¦½íŠ¸)](#-5-2-ì¼ì¹˜-ê°œìˆ˜ì—-ë”°ë¼-ì ìˆ˜-ì¦ê°€-ìŠ¤í¬ë¦½íŠ¸)
    - [### 5-3. íƒœê·¸ ì¼ì¹˜ ìˆ˜ + í‰ì  ì¡°í•© ì ìˆ˜](#-5-3-íƒœê·¸-ì¼ì¹˜-ìˆ˜--í‰ì -ì¡°í•©-ì ìˆ˜)

---

# ğŸ§± 1. Top-level Query Clauseë€?

Elasticsearchì—ì„œ `query` ì•ˆì— ì§ì ‘ ë“¤ì–´ê°€ëŠ” clauseë“¤ì„ ë§í•©ë‹ˆë‹¤. ì˜ˆ:

```json
{
  "query": {
    "match": {
      "title": "Elasticsearch"
    }
  }
}
```

ì—¬ê¸°ì„œ `match`ëŠ” **top-level clause**ì…ë‹ˆë‹¤. ì´ ìë¦¬ì— ì˜¬ ìˆ˜ ìˆëŠ” ëª¨ë“  í›„ë³´ë“¤ì„ í•˜ë‚˜ì”© ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.

---

# Top-level Query Clauses â€” ì „ì²´ ëª©ë¡ê³¼ ì„¤ëª…

## 1. match

**ì„¤ëª…**: ë¶„ì„ê¸°(analyzer)ë¥¼ í†µí•´ í…ìŠ¤íŠ¸ë¥¼ ë‚˜ëˆ„ê³ , ê° í† í°ì´ ë¬¸ì„œì— í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ ê²€ì‚¬í•˜ëŠ” ê°€ì¥ ì¼ë°˜ì ì¸ ì „ì²´ í…ìŠ¤íŠ¸ ê²€ìƒ‰.

**ì˜ˆì œ**:

```json
{
  "query": {
    "match": {
      "title": "machine learning"
    }
  }
}
```

---

## 2. match\_phrase

**ì„¤ëª…**: ë¶„ì„ëœ ë‹¨ì–´ë“¤ì˜ ìˆœì„œì™€ ìœ„ì¹˜ê¹Œì§€ ê³ ë ¤í•˜ì—¬ ì™„ì „í•œ ë¬¸ì¥ì„ ê·¸ëŒ€ë¡œ í¬í•¨í•˜ëŠ” ë¬¸ì„œë¥¼ ì°¾ìŒ.

**ì˜ˆì œ**:

```json
{
  "query": {
    "match_phrase": {
      "title": "machine learning"
    }
  }
}
```

---

## 3. term

**ì„¤ëª…**: ë¶„ì„ë˜ì§€ ì•Šì€ í‚¤ì›Œë“œë‚˜ ìˆ«ì í•„ë“œì— ëŒ€í•´ ì •í™•í•œ ê°’ì„ ê²€ìƒ‰.

**ì˜ˆì œ**:

```json
{
  "query": {
    "term": {
      "status": "published"
    }
  }
}
```

---

## 4. terms

**ì„¤ëª…**: í•˜ë‚˜ì˜ í•„ë“œê°€ ì—¬ëŸ¬ í›„ë³´ ê°’ ì¤‘ í•˜ë‚˜ì™€ ì¼ì¹˜í•˜ë©´ ê²€ìƒ‰.

**ì˜ˆì œ**:

```json
{
  "query": {
    "terms": {
      "status": ["draft", "review"]
    }
  }
}
```

---

## 5. range

**ì„¤ëª…**: ìˆ«ì, ë‚ ì§œ, ë¬¸ìì—´ ë“±ì— ëŒ€í•´ ë²”ìœ„ë¥¼ ì¡°ê±´ìœ¼ë¡œ ê²€ìƒ‰.

**ì˜ˆì œ**:

```json
{
  "query": {
    "range": {
      "price": {
        "gte": 100,
        "lt": 500
      }
    }
  }
}
```

---

## 6. bool

**ì„¤ëª…**: ì—¬ëŸ¬ ì¿¼ë¦¬ë¥¼ ë…¼ë¦¬ì ìœ¼ë¡œ ì¡°í•©. must (AND), must\_not (NOT), should (OR), filter ë“±ì„ ì‚¬ìš© ê°€ëŠ¥.

**ì˜ˆì œ**:

```json
{
  "query": {
    "bool": {
      "must": [
        { "term": { "status": "active" } }
      ],
      "must_not": [
        { "term": { "banned": true } }
      ],
      "should": [
        { "match": { "title": "AI" } }
      ]
    }
  }
}
```

---

## 7. constant\_score

**ì„¤ëª…**: ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ë¬¸ì„œì— ë™ì¼í•œ ì ìˆ˜ë¥¼ ë¶€ì—¬. ì ìˆ˜ ê³„ì‚°ì„ ë¬´ì‹œí•˜ê³  í•„í„°ë§ì—ë§Œ ì§‘ì¤‘í•  ë•Œ ì‚¬ìš©.

**ì˜ˆì œ**:

```json
{
  "query": {
    "constant_score": {
      "filter": {
        "term": {
          "status": "active"
        }
      }
    }
  }
}
```

---

## 8. function\_score

**ì„¤ëª…**: ì¿¼ë¦¬ ê²°ê³¼ì— ëŒ€í•´ ì ìˆ˜ë¥¼ ìˆ˜ì‹ ë˜ëŠ” í•¨ìˆ˜ë¡œ ì¡°ì •. ì˜ˆ: ê±°ë¦¬, ë‚ ì§œ ê¸°ë°˜ ê°€ì¤‘ì¹˜, ì‚¬ìš©ì ì •ì˜ ìŠ¤í¬ë¦½íŠ¸ ë“±.

**ì˜ˆì œ**:

```json
{
  "query": {
    "function_score": {
      "query": {
        "match": { "title": "robotics" }
      },
      "functions": [
        {
          "field_value_factor": {
            "field": "popularity",
            "factor": 1.5
          }
        }
      ],
      "score_mode": "multiply",
      "boost_mode": "sum"
    }
  }
}
```

---

## 9. script\_score

**ì„¤ëª…**: ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì´ìš©í•˜ì—¬ ì ìˆ˜ë¥¼ ì§ì ‘ ê³„ì‚°. `function_score`ì˜ ë‚´ë¶€ ìš”ì†Œë¡œë„ ì‚¬ìš©ë˜ì§€ë§Œ ë‹¨ë… top-level clauseë¡œë„ ê°€ëŠ¥.

**ì˜ˆì œ**:

```json
{
  "query": {
    "script_score": {
      "query": {
        "match_all": {}
      },
      "script": {
        "source": "doc['clicks'].value * 2"
      }
    }
  }
}
```

---

## 10. match\_all

**ì„¤ëª…**: ëª¨ë“  ë¬¸ì„œì™€ ì¼ì¹˜. í•„í„°ë§ ì—†ì´ ì „ì²´ ì¡°íšŒí•  ë•Œ ì‚¬ìš©.

**ì˜ˆì œ**:

```json
{
  "query": {
    "match_all": {}
  }
}
```

---

## 11. match\_none

**ì„¤ëª…**: í•­ìƒ ë¬¸ì„œê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŒ. í…ŒìŠ¤íŠ¸ë‚˜ ì¡°ê±´ë¶€ ì¿¼ë¦¬ì—ì„œ ì‚¬ìš© ê°€ëŠ¥.

**ì˜ˆì œ**:

```json
{
  "query": {
    "match_none": {}
  }
}
```

---

## 12. exists

**ì„¤ëª…**: íŠ¹ì • í•„ë“œê°€ ì¡´ì¬í•˜ëŠ” ë¬¸ì„œë§Œ ì¡°íšŒ.

**ì˜ˆì œ**:

```json
{
  "query": {
    "exists": {
      "field": "user_id"
    }
  }
}
```

---

## 13. prefix

**ì„¤ëª…**: ë¬¸ìì—´ì˜ ì‹œì‘ ë¶€ë¶„ì´ íŠ¹ì • ê°’ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” ê²½ìš°.

**ì˜ˆì œ**:

```json
{
  "query": {
    "prefix": {
      "username": "dav"
    }
  }
}
```

---

## 14. wildcard

**ì„¤ëª…**: ì™€ì¼ë“œì¹´ë“œ(`*`, `?`)ë¥¼ ì‚¬ìš©í•œ ë¬¸ìì—´ ë§¤ì¹­.

**ì˜ˆì œ**:

```json
{
  "query": {
    "wildcard": {
      "email": "david*@gmail.com"
    }
  }
}
```

---

## 15. fuzzy

**ì„¤ëª…**: ì˜¤íƒ€ë‚˜ ìœ ì‚¬í•œ ë¬¸ìì—´ë„ í—ˆìš©í•˜ì—¬ ê²€ìƒ‰.

**ì˜ˆì œ**:

```json
{
  "query": {
    "fuzzy": {
      "name": {
        "value": "david",
        "fuzziness": 2
      }
    }
  }
}
```

---

## 16. multi\_match

**ì„¤ëª…**: ì—¬ëŸ¬ í•„ë“œë¥¼ ë™ì‹œì— ê²€ìƒ‰í•  ë•Œ ì‚¬ìš©.

**ì˜ˆì œ**:

```json
{
  "query": {
    "multi_match": {
      "query": "neural networks",
      "fields": ["title", "description"]
    }
  }
}
```

---

## 17. dis\_max

**ì„¤ëª…**: ì—¬ëŸ¬ ì¿¼ë¦¬ ì¤‘ ê°€ì¥ ë†’ì€ ì ìˆ˜ë¥¼ ê°€ì§„ ê²°ê³¼ë§Œ ìœ ì§€. ì¤‘ë³µ ì¡°ê±´ì˜ ìµœì í™”ì— ìœ ìš©.

**ì˜ˆì œ**:

```json
{
  "query": {
    "dis_max": {
      "queries": [
        { "match": { "title": "AI" } },
        { "match": { "body": "AI" } }
      ],
      "tie_breaker": 0.3
    }
  }
}
```

---

## 18. query\_string

**ì„¤ëª…**: Lucene ë¬¸ë²•ìœ¼ë¡œ ë³µì¡í•œ ì¿¼ë¦¬ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŒ. ì‚¬ìš©ìê°€ ì§ì ‘ ì¿¼ë¦¬ë¬¸ì„ ì‘ì„±í•˜ëŠ” ê²½ìš°ì— ì£¼ë¡œ ì‚¬ìš©.

**ì˜ˆì œ**:

```json
{
  "query": {
    "query_string": {
      "query": "title:AI AND body:robot",
      "default_field": "title"
    }
  }
}
```

---

## 19. simple\_query\_string

**ì„¤ëª…**: query\_stringë³´ë‹¤ ì•ˆì „í•˜ë©°, ì˜¤ë¥˜ë¥¼ ëœ ë°œìƒì‹œí‚¤ëŠ” êµ¬ë¬¸. ì‚¬ìš©ìê°€ ì…ë ¥í•˜ëŠ” ì¿¼ë¦¬ì— ì í•©.

**ì˜ˆì œ**:

```json
{
  "query": {
    "simple_query_string": {
      "query": "\"machine learning\"~5",
      "fields": ["title", "description"]
    }
  }
}
```

# FAQ

## How gauss makes scores?

Elasticsearchì˜ `gauss` í•¨ìˆ˜ëŠ” **ê°€ìš°ì‹œì•ˆ ë¶„í¬(ì •ê·œë¶„í¬)**ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì ìˆ˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤. ìˆ˜ì‹ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

### ê°€ìš°ì‹œì•ˆ í•¨ìˆ˜ì˜ ìˆ˜ì‹

```
score = exp(-0.5 * ((distance / sigma)^2))
```

ì—¬ê¸°ì„œ:
- `distance` = |í˜„ì¬ ê°’ - origin|
- `sigma` = scale ë§¤ê°œë³€ìˆ˜ì—ì„œ ê³„ì‚°ëœ í‘œì¤€í¸ì°¨

### ë§¤ê°œë³€ìˆ˜ ì„¤ëª…

ì„ íƒí•˜ì‹  ì˜ˆì œì—ì„œ:
```json
"gauss": {
  "last_login": {
    "origin": "now",        // ìµœì ê°’ (í˜„ì¬ ì‹œê°„)
    "scale": "7d",          // 7ì¼
    "decay": 0.5            // ê°ì‡ ìœ¨ 50%
  }
}
```

- **origin**: ì ìˆ˜ê°€ ìµœëŒ€(1.0)ê°€ ë˜ëŠ” ê¸°ì¤€ì 
- **scale**: `origin`ì—ì„œ ì–¼ë§ˆë‚˜ ë©€ì–´ì§ˆ ë•Œ `decay` ê°’ë§Œí¼ ê°ì‡ í• ì§€ ê²°ì •
- **decay**: `scale` ê±°ë¦¬ì—ì„œ ì ìˆ˜ê°€ ì–¼ë§ˆë‚˜ ê°ì‡ ë ì§€ (0.5 = 50%)

### ì‹¤ì œ ê³„ì‚° ì˜ˆì‹œ

í˜„ì¬ ì‹œê°„ì„ ê¸°ì¤€ìœ¼ë¡œ ì‚¬ìš©ìì˜ `last_login`ì´ ì–¼ë§ˆë‚˜ ì˜¤ë˜ëëŠ”ì§€ì— ë”°ë¥¸ ì ìˆ˜:

- **ì§€ê¸ˆ ë¡œê·¸ì¸**: ê±°ë¦¬ = 0ì¼ â†’ ì ìˆ˜ = 1.0
- **3.5ì¼ ì „**: ê±°ë¦¬ = 3.5ì¼ â†’ ì ìˆ˜ â‰ˆ 0.7
- **7ì¼ ì „**: ê±°ë¦¬ = 7ì¼ â†’ ì ìˆ˜ = 0.5 (decay ê°’)
- **14ì¼ ì „**: ê±°ë¦¬ = 14ì¼ â†’ ì ìˆ˜ â‰ˆ 0.1
- **21ì¼ ì „**: ê±°ë¦¬ = 21ì¼ â†’ ì ìˆ˜ â‰ˆ 0.02

### ì‹œê°ì  ê·¸ë˜í”„

```
ì ìˆ˜
 1.0 â”¤
     â”‚   â—
 0.8 â”¤    â•²
     â”‚     â•²
 0.6 â”¤      â•²
     â”‚       â•²
 0.4 â”¤        â—  â† 7ì¼ ì§€ì  (decay=0.5)
     â”‚         â•²
 0.2 â”¤          â•²
     â”‚           â•²â—
 0.0 â”¤            â•²___
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      0   7   14   21   ì¼ìˆ˜
```

ì´ë ‡ê²Œ **ìµœê·¼ ì ‘ì†ì¼ìˆ˜ë¡ ë†’ì€ ì ìˆ˜**ë¥¼ ë¶€ì—¬í•˜ê³ , ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ **ë¶€ë“œëŸ½ê²Œ ê°ì†Œ**í•˜ëŠ” ì ìˆ˜ ë¶„í¬ë¥¼ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.

## match_all is mandatory of script_score?

### ì˜¤ë¥˜ ë°œìƒ ì˜ˆì‹œ

```json
{
  "query": {
    "script_score": {
      "script": {
        "source": "doc['purchase_count'].value * 0.5 + doc['review_score'].value * 2"
      }
    }
  }
}
```

ì´ë ‡ê²Œ í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤:

```json
{
  "error": {
    "type": "parsing_exception",
    "reason": "[script_score] query malformed, no start_object after query name"
  }
}
```

### script_scoreì˜ ë™ì‘ ì›ë¦¬

`script_score`ëŠ” **2ë‹¨ê³„ í”„ë¡œì„¸ìŠ¤**ë¡œ ë™ì‘í•©ë‹ˆë‹¤:

1. **1ë‹¨ê³„**: `query` ë¶€ë¶„ìœ¼ë¡œ ë¬¸ì„œ í•„í„°ë§
2. **2ë‹¨ê³„**: í•„í„°ë§ëœ ë¬¸ì„œë“¤ì— ëŒ€í•´ `script`ë¡œ ì ìˆ˜ ê³„ì‚°

```json
{
  "script_score": {
    "query": {          // 1ë‹¨ê³„: ì–´ë–¤ ë¬¸ì„œë“¤ì„ ëŒ€ìƒìœ¼ë¡œ í•  ê²ƒì¸ê°€?
      "match_all": {}    // â†’ ëª¨ë“  ë¬¸ì„œ
    },
    "script": {          // 2ë‹¨ê³„: ì„ íƒëœ ë¬¸ì„œë“¤ì˜ ì ìˆ˜ë¥¼ ì–´ë–»ê²Œ ê³„ì‚°í•  ê²ƒì¸ê°€?
      "source": "doc['purchase_count'].value * 0.5 + doc['review_score'].value * 2"
    }
  }
}
```

### ë‹¤ë¥¸ query ì˜ˆì‹œë“¤

#### íŠ¹ì • ì¡°ê±´ ë¬¸ì„œë§Œ ì ìˆ˜ ê³„ì‚°
```json
{
  "script_score": {
    "query": {
      "term": { "status": "active" }    // active ì‚¬ìš©ìë§Œ ëŒ€ìƒ
    },
    "script": {
      "source": "doc['purchase_count'].value * 0.5 + doc['review_score'].value * 2"
    }
  }
}
```

#### ë³µí•© ì¡°ê±´
```json
{
  "script_score": {
    "query": {
      "bool": {
        "must": [
          { "range": { "age": { "gte": 18 } } },
          { "term": { "verified": true } }
        ]
      }
    },
    "script": {
      "source": "doc['purchase_count'].value * 0.5 + doc['review_score'].value * 2"
    }
  }
}
```

**ê²°ë¡ **: `query` ë¶€ë¶„ì´ ì—†ìœ¼ë©´ Elasticsearchê°€ ì–´ë–¤ ë¬¸ì„œë“¤ì„ ëŒ€ìƒìœ¼ë¡œ ì ìˆ˜ë¥¼ ê³„ì‚°í• ì§€ ì•Œ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— **êµ¬ë¬¸ ì˜¤ë¥˜**ê°€ ë°œìƒí•©ë‹ˆë‹¤. `match_all`ì€ "ëª¨ë“  ë¬¸ì„œë¥¼ ëŒ€ìƒìœ¼ë¡œ í•˜ê² ë‹¤"ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.

## How boost_mode makes scores?

`boost_mode`ëŠ” **ì›ë˜ ì¿¼ë¦¬ì˜ ì ìˆ˜**ì™€ **í•¨ìˆ˜ë“¤ì˜ ì ìˆ˜**ë¥¼ ì–´ë–»ê²Œ ê²°í•©í• ì§€ ê²°ì •í•˜ëŠ” ë§¤ê°œë³€ìˆ˜ì…ë‹ˆë‹¤.

### function_score ì ìˆ˜ ê³„ì‚° ê³¼ì •

```
1ë‹¨ê³„: ì›ë˜ ì¿¼ë¦¬ ì ìˆ˜ ê³„ì‚°
2ë‹¨ê³„: ê° í•¨ìˆ˜ì˜ ì ìˆ˜ ê³„ì‚°  
3ë‹¨ê³„: score_modeë¡œ í•¨ìˆ˜ ì ìˆ˜ë“¤ ê²°í•©
4ë‹¨ê³„: boost_modeë¡œ ì›ë˜ ì ìˆ˜ì™€ í•¨ìˆ˜ ì ìˆ˜ ìµœì¢… ê²°í•©
```

### boost_mode ì˜µì…˜ë“¤

#### 1. `multiply` (ì˜ˆì œì—ì„œ ì‚¬ìš©)
```
ìµœì¢…ì ìˆ˜ = ì›ë˜ì ìˆ˜ Ã— í•¨ìˆ˜ì ìˆ˜
```

#### 2. `sum`
```
ìµœì¢…ì ìˆ˜ = ì›ë˜ì ìˆ˜ + í•¨ìˆ˜ì ìˆ˜
```

#### 3. `avg`
```
ìµœì¢…ì ìˆ˜ = (ì›ë˜ì ìˆ˜ + í•¨ìˆ˜ì ìˆ˜) / 2
```

#### 4. `max`
```
ìµœì¢…ì ìˆ˜ = max(ì›ë˜ì ìˆ˜, í•¨ìˆ˜ì ìˆ˜)
```

#### 5. `min`
```
ìµœì¢…ì ìˆ˜ = min(ì›ë˜ì ìˆ˜, í•¨ìˆ˜ì ìˆ˜)
```

#### 6. `replace`
```
ìµœì¢…ì ìˆ˜ = í•¨ìˆ˜ì ìˆ˜ (ì›ë˜ì ìˆ˜ ë¬´ì‹œ)
```

### êµ¬ì²´ì ì¸ ê³„ì‚° ì˜ˆì‹œ

ì„ íƒí•˜ì‹  ì˜ˆì œì—ì„œ:

```json
{
  "query": { "term": { "status": "active" } },  // ì›ë˜ ì¿¼ë¦¬
  "functions": [
    { "gauss": { "last_login": {...} } },       // í•¨ìˆ˜1: 0.8ì 
    { "field_value_factor": { "activity_score": {...} } }  // í•¨ìˆ˜2: 1.5ì 
  ],
  "score_mode": "sum",        // í•¨ìˆ˜ì ìˆ˜ ê²°í•©: 0.8 + 1.5 = 2.3
  "boost_mode": "multiply"    // ìµœì¢… ê²°í•© ë°©ì‹
}
```

**ê°€ì •**: 
- ì›ë˜ ì¿¼ë¦¬ ì ìˆ˜: 1.2
- gauss í•¨ìˆ˜ ì ìˆ˜: 0.8
- field_value_factor ì ìˆ˜: 1.5

**ê³„ì‚° ê³¼ì •**:
1. **í•¨ìˆ˜ì ìˆ˜ ê²°í•©** (score_mode="sum"): 0.8 + 1.5 = 2.3
2. **ìµœì¢…ì ìˆ˜ ê³„ì‚°** (boost_mode="multiply"): 1.2 Ã— 2.3 = **2.76**

### boost_modeë³„ ê²°ê³¼ ë¹„êµ

ê°™ì€ ì¡°ê±´ì—ì„œ boost_modeë§Œ ë°”ê¾¼ ê²½ìš°:

| boost_mode | ê³„ì‚°ì‹ | ê²°ê³¼ |
|------------|--------|------|
| multiply   | 1.2 Ã— 2.3 | 2.76 |
| sum        | 1.2 + 2.3 | 3.5  |
| avg        | (1.2 + 2.3) / 2 | 1.75 |
| max        | max(1.2, 2.3) | 2.3  |
| min        | min(1.2, 2.3) | 1.2  |
| replace    | 2.3 | 2.3  |

**ê²°ë¡ **: `boost_mode="multiply"`ëŠ” ì›ë˜ ì¿¼ë¦¬ì™€ í•¨ìˆ˜ê°€ ëª¨ë‘ ë†’ì€ ì ìˆ˜ë¥¼ ê°€ì§ˆ ë•Œ **ìƒìŠ¹íš¨ê³¼**ë¥¼ ë§Œë“¤ì–´ ë” ë†’ì€ ì ìˆ˜ë¥¼ ë¶€ì—¬í•©ë‹ˆë‹¤.

## function_score vs script_score?

`function_score`ì™€ `script_score`ëŠ” ëª¨ë‘ **ì ìˆ˜ ê³„ì‚°ì„ ìœ„í•œ ì¿¼ë¦¬**ì´ì§€ë§Œ, ì ‘ê·¼ ë°©ì‹ê³¼ ì‚¬ìš© ëª©ì ì´ ë‹¤ë¦…ë‹ˆë‹¤.

### ì£¼ìš” ì°¨ì´ì 

| êµ¬ë¶„ | function_score | script_score |
|------|----------------|--------------|
| **ê³„ì‚° ë°©ì‹** | ë¯¸ë¦¬ ì •ì˜ëœ í•¨ìˆ˜ë“¤ ì¡°í•© | ì§ì ‘ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± |
| **ë³µì¡ì„±** | êµ¬ì¡°í™”ëœ ì„¤ì • | ììœ ë¡œìš´ ë¡œì§ êµ¬í˜„ |
| **ì„±ëŠ¥** | ìµœì í™”ëœ ë‚´ì¥ í•¨ìˆ˜ | ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ì˜¤ë²„í—¤ë“œ |
| **ìœ ì—°ì„±** | ì œí•œì  | ë¬´ì œí•œ |

### 1. function_score - êµ¬ì¡°í™”ëœ ì ‘ê·¼

```json
{
  "function_score": {
    "query": { "term": { "status": "active" } },
    "functions": [
      {
        "gauss": {
          "last_login": {
            "origin": "now",
            "scale": "7d",
            "decay": 0.5
          }
        }
      },
      {
        "field_value_factor": {
          "field": "activity_score",
          "factor": 1.2
        }
      }
    ],
    "score_mode": "sum",
    "boost_mode": "multiply"
  }
}
```

**íŠ¹ì§•**:
- ë¯¸ë¦¬ ì •ì˜ëœ í•¨ìˆ˜ë“¤ (`gauss`, `field_value_factor`, `random_score` ë“±)
- ì—¬ëŸ¬ í•¨ìˆ˜ë¥¼ ì¡°í•© ê°€ëŠ¥
- `score_mode`, `boost_mode`ë¡œ ì ìˆ˜ ê²°í•© ë°©ì‹ ì œì–´
- ì„±ëŠ¥ ìµœì í™”ë¨

### 2. script_score - ììœ ë¡œìš´ ë¡œì§

```json
{
  "script_score": {
    "query": { "term": { "status": "active" } },
    "script": {
      "source": """
        double login_score = Math.exp(-0.5 * Math.pow((System.currentTimeMillis() - doc['last_login'].value.millis) / (7 * 24 * 60 * 60 * 1000), 2));
        double activity_score = doc['activity_score'].value * 1.2;
        return login_score + activity_score;
      """
    }
  }
}
```

**íŠ¹ì§•**:
- ì§ì ‘ ìŠ¤í¬ë¦½íŠ¸ë¡œ ì ìˆ˜ ê³„ì‚° ë¡œì§ ì‘ì„±
- ë³µì¡í•œ ìˆ˜í•™ì  ê³„ì‚° ê°€ëŠ¥
- ì¡°ê±´ë¬¸, ë°˜ë³µë¬¸ ë“± í”„ë¡œê·¸ë˜ë° ë¡œì§ ì‚¬ìš©
- ë” ëŠë¦´ ìˆ˜ ìˆìŒ

### ì–¸ì œ ì–´ë–¤ ê²ƒì„ ì‚¬ìš©í• ê¹Œ?

#### function_score ì‚¬ìš© ê¶Œì¥
- **ì¼ë°˜ì ì¸ ì ìˆ˜ ì¡°ì •**: ê±°ë¦¬, ë‚ ì§œ, í•„ë“œê°’ ê¸°ë°˜
- **ì„±ëŠ¥ì´ ì¤‘ìš”í•œ ê²½ìš°**
- **ì—¬ëŸ¬ í•¨ìˆ˜ ì¡°í•©ì´ í•„ìš”í•œ ê²½ìš°**
- **ìœ ì§€ë³´ìˆ˜ê°€ ì¤‘ìš”í•œ ê²½ìš°**

```json
{
  "function_score": {
    "functions": [
      { "gauss": { "location": {...} } },     // ê±°ë¦¬ ê¸°ë°˜
      { "gauss": { "date": {...} } },         // ë‚ ì§œ ê¸°ë°˜
      { "field_value_factor": { "field": "popularity" } }  // ì¸ê¸°ë„ ê¸°ë°˜
    ]
  }
}
```

#### script_score ì‚¬ìš© ê¶Œì¥
- **ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§**
- **ì¡°ê±´ë¶€ ê³„ì‚°**
- **function_scoreë¡œ ë¶ˆê°€ëŠ¥í•œ ê³„ì‚°**

```json
{
  "script_score": {
    "script": {
      "source": """
        if (doc['user_type'].value == 'premium') {
          return doc['base_score'].value * 2;
        } else if (doc['purchase_count'].value > 10) {
          return doc['base_score'].value * 1.5;
        } else {
          return doc['base_score'].value;
        }
      """
    }
  }
}
```

### ì„±ëŠ¥ ë¹„êµ

```
function_score: ë¹ ë¦„ âš¡âš¡âš¡
script_score:   ëŠë¦¼ âš¡
```

**ê²°ë¡ **: 
- **ë‹¨ìˆœí•œ ì ìˆ˜ ì¡°ì •**: `function_score` ì‚¬ìš©
- **ë³µì¡í•œ ë¡œì§**: `script_score` ì‚¬ìš©
- **ì„±ëŠ¥ ìš°ì„ **: `function_score` ì„ íƒ


## How tie_breaker makes scores?

`tie_breaker`ëŠ” **dis_max ì¿¼ë¦¬ì—ì„œ ìµœê³  ì ìˆ˜ ì™¸ì˜ ë‹¤ë¥¸ ì¿¼ë¦¬ ì ìˆ˜ë“¤ì„ ì–¼ë§ˆë‚˜ ë°˜ì˜í• ì§€** ê²°ì •í•˜ëŠ” ë§¤ê°œë³€ìˆ˜ì…ë‹ˆë‹¤.

### dis_maxì˜ ê¸°ë³¸ ë™ì‘

`dis_max`ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ **ê°€ì¥ ë†’ì€ ì ìˆ˜ë§Œ** ì‚¬ìš©í•©ë‹ˆë‹¤:

```json
{
  "dis_max": {
    "queries": [
      { "match": { "title": "chatbot" } },    // ì ìˆ˜: 2.0
      { "match": { "body": "chatbot" } }      // ì ìˆ˜: 1.5
    ]
  }
}
```

**tie_breaker ì—†ì´**: ìµœì¢… ì ìˆ˜ = 2.0 (ìµœê³ ì ìˆ˜ë§Œ)

### tie_breakerì˜ ì—­í• 

### ê³„ì‚° ê³µì‹
```
ìµœì¢…ì ìˆ˜ = ìµœê³ ì ìˆ˜ + (ë‹¤ë¥¸ì ìˆ˜ë“¤ì˜ í•© Ã— tie_breaker)
```

#### ì˜ˆì œ ê³„ì‚°

ì„ íƒí•˜ì‹  ì˜ˆì œì—ì„œ:
- title ë§¤ì¹­ ì ìˆ˜: 2.0
- body ë§¤ì¹­ ì ìˆ˜: 1.5
- tie_breaker: 0.3

```
ìµœì¢…ì ìˆ˜ = 2.0 + (1.5 Ã— 0.3) = 2.0 + 0.45 = 2.45
```

### tie_breaker ê°’ì— ë”°ë¥¸ ì°¨ì´

| tie_breaker | ê³„ì‚° | ê²°ê³¼ | ì˜ë¯¸ |
|-------------|------|------|------|
| 0.0 (ê¸°ë³¸ê°’) | 2.0 + (1.5 Ã— 0.0) | 2.0 | ìµœê³ ì ìˆ˜ë§Œ ì‚¬ìš© |
| 0.3 | 2.0 + (1.5 Ã— 0.3) | 2.45 | ë‹¤ë¥¸ ì ìˆ˜ 30% ë°˜ì˜ |
| 0.5 | 2.0 + (1.5 Ã— 0.5) | 2.75 | ë‹¤ë¥¸ ì ìˆ˜ 50% ë°˜ì˜ |
| 1.0 | 2.0 + (1.5 Ã— 1.0) | 3.5 | ëª¨ë“  ì ìˆ˜ í•©ê³„ (bool shouldì™€ ë™ì¼) |

### ì‹¤ì œ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

#### 1. ì œëª© ìš°ì„ , ë³¸ë¬¸ ë³´ì¡° ê³ ë ¤

```json
{
  "dis_max": {
    "queries": [
      { "match": { "title": "machine learning" } },
      { "match": { "content": "machine learning" } }
    ],
    "tie_breaker": 0.3
  }
}
```

**ì˜ë„**: ì œëª© ë§¤ì¹­ì´ ìš°ì„ ì´ì§€ë§Œ, ë³¸ë¬¸ ë§¤ì¹­ë„ ì–´ëŠ ì •ë„ ë°˜ì˜

#### 2. ì—¬ëŸ¬ í•„ë“œ ê²€ìƒ‰ì—ì„œ ê· í˜• ì¡°ì •

```json
{
  "dis_max": {
    "queries": [
      { "match": { "name": "david" } },
      { "match": { "email": "david" } },
      { "match": { "description": "david" } }
    ],
    "tie_breaker": 0.2
  }
}
```

**ì˜ë„**: ê°€ì¥ ì˜ ë§¤ì¹­ë˜ëŠ” í•„ë“œ ìš°ì„ , ë‹¤ë¥¸ í•„ë“œë“¤ë„ ì†ŒëŸ‰ ë°˜ì˜

### tie_breaker vs bool should ë¹„êµ

#### dis_max (tie_breaker=0.3)
```
ì ìˆ˜ = max(ì ìˆ˜ë“¤) + (ë‚˜ë¨¸ì§€ì ìˆ˜ë“¤ Ã— 0.3)
```

#### bool should
```
ì ìˆ˜ = ëª¨ë“  ì ìˆ˜ë“¤ì˜ í•©
```

**ì–¸ì œ ì‚¬ìš©í• ê¹Œ?**

- **dis_max + tie_breaker**: í•˜ë‚˜ì˜ í•„ë“œê°€ ì£¼ìš”í•˜ê³  ë‹¤ë¥¸ í•„ë“œë“¤ì€ ë³´ì¡°ì ì¼ ë•Œ
- **bool should**: ëª¨ë“  í•„ë“œê°€ ë™ë“±í•˜ê²Œ ì¤‘ìš”í•  ë•Œ

**ê²°ë¡ **: `tie_breaker`ëŠ” **ì£¼ìš” ë§¤ì¹­ ì™¸ì— ë‹¤ë¥¸ ë§¤ì¹­ë“¤ë„ ì•½ê°„ì”© ê³ ë ¤**í•˜ì—¬ ë” ì •êµí•œ ê´€ë ¨ì„± ì ìˆ˜ë¥¼ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.

# í˜„ì‹¤ì ì¸ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì‹¤ìŠµ ì˜ˆì œ

---

## 1. `match` â€“ ì‚¬ìš©ìê°€ ì…ë ¥í•œ ê²€ìƒ‰ì–´ë¡œ ë¸”ë¡œê·¸ ì œëª© ì°¾ê¸°

**ì‹œë‚˜ë¦¬ì˜¤**: ì‚¬ìš©ìê°€ "deep learning"ì´ë¼ëŠ” í‚¤ì›Œë“œë¡œ ë¸”ë¡œê·¸ ê¸€ì„ ê²€ìƒ‰í•¨

```json
{
  "query": {
    "match": {
      "title": "deep learning"
    }
  }
}
```

**ì„¤ëª…**: í…ìŠ¤íŠ¸ëŠ” ë¶„ì„ë˜ì–´ "deep"ê³¼ "learning" ë‘ ë‹¨ì–´ë¡œ ë¶„ë¦¬ë˜ê³ , ì´ ë‹¨ì–´ë“¤ì„ ëª¨ë‘ í¬í•¨í•œ ë¬¸ì„œê°€ ê²€ìƒ‰ë©ë‹ˆë‹¤.

---

## 2. `term` â€“ íŠ¹ì • ìƒíƒœì¸ ìƒí’ˆ ê²€ìƒ‰

**ì‹œë‚˜ë¦¬ì˜¤**: ìƒí’ˆ ìƒíƒœê°€ `"available"`ì¸ ìƒí’ˆë§Œ ê²€ìƒ‰í•˜ê³  ì‹¶ìŒ

```json
{
  "query": {
    "term": {
      "status": "available"
    }
  }
}
```

**ì„¤ëª…**: status í•„ë“œëŠ” í‚¤ì›Œë“œ(keyword) íƒ€ì…ì´ì–´ì•¼ í•˜ê³ , ë¶„ì„ ì—†ì´ ì •í™•íˆ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.

---

## 3. `terms` â€“ íŠ¹ì • ì¹´í…Œê³ ë¦¬ì— ì†í•œ ê²Œì‹œë¬¼ë“¤ ì°¾ê¸°

**ì‹œë‚˜ë¦¬ì˜¤**: ì¹´í…Œê³ ë¦¬ê°€ "tech", "science", ë˜ëŠ” "math"ì¸ ê¸€ ëª©ë¡ í•„í„°ë§

```json
{
  "query": {
    "terms": {
      "category": ["tech", "science", "math"]
    }
  }
}
```

---

## 4. `range` â€“ íŠ¹ì • ê°€ê²©ëŒ€ ìƒí’ˆ ê²€ìƒ‰

**ì‹œë‚˜ë¦¬ì˜¤**: 10,000ì› ì´ìƒ 50,000ì› ë¯¸ë§Œì¸ ìƒí’ˆì„ ì°¾ìŒ

```json
{
  "query": {
    "range": {
      "price": {
        "gte": 10000,
        "lt": 50000
      }
    }
  }
}
```

---

## 5. `bool` â€“ ì—¬ëŸ¬ ì¡°ê±´ì„ ì¡°í•©

**ì‹œë‚˜ë¦¬ì˜¤**: ì œëª©ì— "machine"ì´ í¬í•¨ë˜ê³ , ìƒíƒœê°€ "active"ì´ë©°, ê¸ˆì§€ ì‚¬ìš©ìëŠ” ì œì™¸

```json
{
  "query": {
    "bool": {
      "must": [
        { "match": { "title": "machine" } },
        { "term": { "status": "active" } }
      ],
      "must_not": [
        { "term": { "banned": true } }
      ]
    }
  }
}
```

---

## 6. `constant_score` â€“ ì ìˆ˜ ë¬´ì‹œí•˜ê³  ë‹¨ìˆœ í•„í„°

**ì‹œë‚˜ë¦¬ì˜¤**: ê´‘ê³ ìš© ì‚¬ìš©ì í•„í„°ë§, relevance ì ìˆ˜ëŠ” í•„ìš” ì—†ìŒ

```json
{
  "query": {
    "constant_score": {
      "filter": {
        "term": {
          "user_type": "premium"
        }
      }
    }
  }
}
```

---

## 7. `function_score` â€“ ìµœê·¼ ì ‘ì† ì‹œê°„ê³¼ í™œë™ ì ìˆ˜ë¡œ ì‚¬ìš©ì ìˆœìœ„ ê²°ì •

**ì‹œë‚˜ë¦¬ì˜¤**: ì¡°ê±´ì— ë§ëŠ” ì‚¬ìš©ì ì¤‘, ìµœê·¼ ì ‘ì†í•œ ì‚¬ëŒê³¼ í™œë™ ì ìˆ˜ê°€ ë†’ì€ ì‚¬ëŒì—ê²Œ ê°€ì¤‘ì¹˜ ë¶€ì—¬

```json
{
  "query": {
    "function_score": {
      "query": {
        "term": {
          "status": "active"
        }
      },
      "functions": [
        {
          "gauss": {
            "last_login": {
              "origin": "now",
              "scale": "7d",
              "decay": 0.5
            }
          }
        },
        {
          "field_value_factor": {
            "field": "activity_score",
            "factor": 1.2
          }
        }
      ],
      "score_mode": "sum",
      "boost_mode": "multiply"
    }
  }
}
```

---

## 8. `script_score` â€“ ì‚¬ìš©ì ë§ì¶¤ ì ìˆ˜ ê³„ì‚°

**ì‹œë‚˜ë¦¬ì˜¤**: ì‚¬ìš©ìì˜ êµ¬ë§¤ ìˆ˜ì— ë”°ë¼ ë§ì¶¤ ì ìˆ˜ ê³„ì‚°

```json
{
  "query": {
    "script_score": {
      "query": {
        "match_all": {}
      },
      "script": {
        "source": "doc['purchase_count'].value * 0.5 + doc['review_score'].value * 2"
      }
    }
  }
}
```

---

## 9. `match_phrase` â€“ ì •í™•í•œ ë¬¸ì¥ í¬í•¨ ê²€ìƒ‰

**ì‹œë‚˜ë¦¬ì˜¤**: "artificial intelligence"ë¼ëŠ” ë¬¸ì¥ì´ í¬í•¨ëœ ê¸€ ê²€ìƒ‰

```json
{
  "query": {
    "match_phrase": {
      "content": "artificial intelligence"
    }
  }
}
```

---

## 10. `exists` â€“ íŠ¹ì • í•„ë“œê°€ ì¡´ì¬í•˜ëŠ” ë¬¸ì„œë§Œ í•„í„°ë§

**ì‹œë‚˜ë¦¬ì˜¤**: ì´ë©”ì¼ ì£¼ì†Œê°€ ì…ë ¥ëœ ì‚¬ìš©ìë§Œ ì°¾ê¸°

```json
{
  "query": {
    "exists": {
      "field": "email"
    }
  }
}
```

---

## 11. `prefix` â€“ ë¬¸ìì—´ ì‹œì‘ ì¡°ê±´ ê²€ìƒ‰

**ì‹œë‚˜ë¦¬ì˜¤**: ì´ë¦„ì´ "da"ë¡œ ì‹œì‘í•˜ëŠ” ì‚¬ìš©ì ê²€ìƒ‰

```json
{
  "query": {
    "prefix": {
      "name": "da"
    }
  }
}
```

---

## 12. `wildcard` â€“ ìœ ì—°í•œ íŒ¨í„´ ê²€ìƒ‰

**ì‹œë‚˜ë¦¬ì˜¤**: "david"ë¡œ ì‹œì‘í•˜ê³  "@gmail.com"ìœ¼ë¡œ ëë‚˜ëŠ” ì´ë©”ì¼ ê²€ìƒ‰

```json
{
  "query": {
    "wildcard": {
      "email": "david*@gmail.com"
    }
  }
}
```

---

## 13. `fuzzy` â€“ ì˜¤íƒ€ í—ˆìš© ê²€ìƒ‰

**ì‹œë‚˜ë¦¬ì˜¤**: "david"ë¥¼ ì˜¤íƒ€ í¬í•¨í•˜ì—¬ ê²€ìƒ‰ (ì˜ˆ: "dvid", "david", "dvaid")

```json
{
  "query": {
    "fuzzy": {
      "name": {
        "value": "david",
        "fuzziness": 2
      }
    }
  }
}
```

---

## 14. `multi_match` â€“ ì—¬ëŸ¬ í•„ë“œì—ì„œ í‚¤ì›Œë“œ ê²€ìƒ‰

**ì‹œë‚˜ë¦¬ì˜¤**: ì œëª©ì´ë‚˜ ì„¤ëª…ì—ì„œ "quantum computing" ê²€ìƒ‰

```json
{
  "query": {
    "multi_match": {
      "query": "quantum computing",
      "fields": ["title", "description"]
    }
  }
}
```

---

## 15. `dis_max` â€“ ì—¬ëŸ¬ ì¿¼ë¦¬ ì¤‘ ìµœê³  ì ìˆ˜ë§Œ ì‚¬ìš©

**ì‹œë‚˜ë¦¬ì˜¤**: ì œëª© ë˜ëŠ” ë³¸ë¬¸ì— "chatbot"ì´ ìˆì„ ë•Œ, í•˜ë‚˜ë¼ë„ ì¼ì¹˜í•˜ë©´ ë¬¸ì„œë¥¼ í¬í•¨ì‹œí‚¤ë˜ ë” ì˜ ë§ëŠ” ìª½ì˜ ì ìˆ˜ë¡œ ì •ë ¬

```json
{
  "query": {
    "dis_max": {
      "queries": [
        { "match": { "title": "chatbot" } },
        { "match": { "body": "chatbot" } }
      ],
      "tie_breaker": 0.3
    }
  }
}
```

---

## 16. `query_string` â€“ ë³µì¡í•œ ìˆ˜ì‹ ê²€ìƒ‰

**ì‹œë‚˜ë¦¬ì˜¤**: ì‚¬ìš©ìê°€ ì§ì ‘ `"AI AND robot"`ê³¼ ê°™ì€ êµ¬ë¬¸ì„ ì…ë ¥í–ˆì„ ë•Œ

```json
{
  "query": {
    "query_string": {
      "query": "title:AI AND body:robot",
      "default_field": "body"
    }
  }
}
```

---

## 17. `simple_query_string` â€“ ì•ˆì „í•œ ìˆ˜ì‹ ê²€ìƒ‰

**ì‹œë‚˜ë¦¬ì˜¤**: ê²€ìƒ‰ì–´ì— ë¬¸ë²• ì˜¤ë¥˜ê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì—ëŸ¬ ë°œìƒ ì—†ì´ ê²€ìƒ‰ ì‹¤í–‰

```json
{
  "query": {
    "simple_query_string": {
      "query": "\"deep learning\"~5",
      "fields": ["title", "body"]
    }
  }
}
```

---

## 18. `match_all` â€“ ì „ì²´ ë¬¸ì„œ ì¡°íšŒ

**ì‹œë‚˜ë¦¬ì˜¤**: ëª¨ë“  ë¬¸ì„œë¥¼ ì ìˆ˜ì™€ ë¬´ê´€í•˜ê²Œ ê°€ì ¸ì˜¤ê¸°

```json
{
  "query": {
    "match_all": {}
  }
}
```

---

## 19. `match_none` â€“ ì¡°ê±´ì— ë”°ë¼ ê²°ê³¼ê°€ ì—†ì–´ì•¼ í•˜ëŠ” ê²½ìš°

**ì‹œë‚˜ë¦¬ì˜¤**: í•„í„° ì¡°ê±´ì´ ë§ì§€ ì•ŠëŠ” ê²½ìš°, ê°•ì œë¡œ ë¹ˆ ê²°ê³¼ë¥¼ ë¦¬í„´

```json
{
  "query": {
    "match_none": {}
  }
}
```

---

# ì¢€ë” ë³µì¡í•œ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì‹¤ìŠµ ì˜ˆì œ

## ì‹œë‚˜ë¦¬ì˜¤ 1: ì‚¬ìš©ìì˜ ì„ í˜¸ ì¥ë¥´ ê¸°ë°˜ ì˜í™” ì¶”ì²œ

### 1-1. ê¸°ë³¸ terms í•„í„°ë§

```json
{
  "query": {
    "terms": {
      "genre": ["sci-fi", "action"]
    }
  }
}
```

### 1-2. genre + ìµœì‹  ê°œë´‰ì¼ ìˆœ ì •ë ¬

```json
{
  "query": {
    "bool": {
      "must": [
        { "terms": { "genre": ["sci-fi", "action"] } }
      ]
    }
  },
  "sort": [
    { "release_date": "desc" }
  ]
}
```

### 1-3. genre í•„í„° + í‰ì  ê¸°ë°˜ ê°€ì¤‘ì¹˜ ë¶€ì—¬

```json
{
  "query": {
    "function_score": {
      "query": {
        "terms": {
          "genre": ["sci-fi", "action"]
        }
      },
      "functions": [
        {
          "field_value_factor": {
            "field": "rating",
            "factor": 1.5,
            "missing": 3.0
          }
        }
      ],
      "score_mode": "sum",
      "boost_mode": "multiply"
    }
  }
}
```

---

## ## ì‹œë‚˜ë¦¬ì˜¤ 2: ì‚¬ìš©ì ìœ„ì¹˜ ê¸°ë°˜ ê·¼ì²˜ ì´ë²¤íŠ¸ ì¶”ì²œ

### ### 2-1. ë°˜ê²½ 10km ì´ë²¤íŠ¸ í•„í„°

```json
{
  "query": {
    "geo_distance": {
      "distance": "10km",
      "location": {
        "lat": 37.4979,
        "lon": 127.0276
      }
    }
  }
}
```

### ### 2-2. ê°€ê¹Œìš´ ê±°ë¦¬ì¼ìˆ˜ë¡ ë†’ì€ ì ìˆ˜ (gauss ì‚¬ìš©)

```json
{
  "query": {
    "function_score": {
      "query": {
        "geo_distance": {
          "distance": "10km",
          "location": {
            "lat": 37.4979,
            "lon": 127.0276
          }
        }
      },
      "functions": [
        {
          "gauss": {
            "location": {
              "origin": "37.4979,127.0276",
              "scale": "2km",
              "decay": 0.5
            }
          }
        }
      ]
    }
  }
}
```

### ### 2-3. ê±°ë¦¬ + ì¸ê¸° ì ìˆ˜ ì¡°í•©

```json
{
  "query": {
    "function_score": {
      "query": {
        "geo_distance": {
          "distance": "10km",
          "location": {
            "lat": 37.4979,
            "lon": 127.0276
          }
        }
      },
      "functions": [
        {
          "gauss": {
            "location": {
              "origin": "37.4979,127.0276",
              "scale": "2km",
              "decay": 0.5
            }
          }
        },
        {
          "field_value_factor": {
            "field": "popularity_score",
            "factor": 1.2
          }
        }
      ],
      "score_mode": "sum",
      "boost_mode": "multiply"
    }
  }
}
```

---

## ## ì‹œë‚˜ë¦¬ì˜¤ 3: ìµœê·¼ ì ‘ì† ì‚¬ìš©ì ìš°ì„  ì¶”ì²œ

### ### 3-1. ìµœê·¼ 7ì¼ ë‚´ ì ‘ì† í•„í„°

```json
{
  "query": {
    "range": {
      "last_login": {
        "gte": "now-7d/d"
      }
    }
  }
}
```

### ### 3-2. ìµœê·¼ ì ‘ì†ì¼ì´ ê°€ê¹Œìš¸ìˆ˜ë¡ ì ìˆ˜ ë†’ì„ (gauss)

```json
{
  "query": {
    "function_score": {
      "query": {
        "match_all": {}
      },
      "functions": [
        {
          "gauss": {
            "last_login": {
              "origin": "now",
              "scale": "7d",
              "decay": 0.3
            }
          }
        }
      ]
    }
  }
}
```

### ### 3-3. ìµœê·¼ ì ‘ì† + í™œë™ì ìˆ˜ ì¡°í•©

```json
{
  "query": {
    "function_score": {
      "query": {
        "term": { "status": "active" }
      },
      "functions": [
        {
          "gauss": {
            "last_login": {
              "origin": "now",
              "scale": "7d",
              "decay": 0.3
            }
          }
        },
        {
          "field_value_factor": {
            "field": "activity_score",
            "factor": 1.1
          }
        }
      ],
      "score_mode": "sum",
      "boost_mode": "multiply"
    }
  }
}
```

---

## ## ì‹œë‚˜ë¦¬ì˜¤ 4: í™œë™ ì ìˆ˜ ê¸°ë°˜ ì •ë ¬

### ### 4-1. ë‹¨ìˆœí•œ `activity_score` ê¸°ì¤€ ì •ë ¬

```json
{
  "query": {
    "match_all": {}
  },
  "sort": [
    { "activity_score": "desc" }
  ]
}
```

### ### 4-2. ì ìˆ˜ ì—†ì„ ê²½ìš° ê¸°ë³¸ê°’ ë¶€ì—¬

```json
{
  "query": {
    "function_score": {
      "query": {
        "match_all": {}
      },
      "functions": [
        {
          "field_value_factor": {
            "field": "activity_score",
            "missing": 0.1
          }
        }
      ]
    }
  }
}
```

### ### 4-3. í™œë™ ì ìˆ˜ + í‰íŒ ì ìˆ˜ ìŠ¤í¬ë¦½íŠ¸ ê¸°ë°˜ ì¡°í•©

```json
{
  "query": {
    "script_score": {
      "query": {
        "match_all": {}
      },
      "script": {
        "source": "doc['activity_score'].value * 0.7 + doc['reputation_score'].value * 0.3"
      }
    }
  }
}
```

---

## ## ì‹œë‚˜ë¦¬ì˜¤ 5: ì‚¬ìš©ì íƒœê·¸ì™€ ì•„ì´í…œ íƒœê·¸ ë§¤ì¹­

### ### 5-1. ì‚¬ìš©ì ì„ í˜¸ íƒœê·¸ì™€ ì¼ì¹˜í•˜ëŠ” íƒœê·¸ ê²€ìƒ‰

```json
{
  "query": {
    "terms": {
      "tags": ["eco", "vegan", "organic"]
    }
  }
}
```

### ### 5-2. ì¼ì¹˜ ê°œìˆ˜ì— ë”°ë¼ ì ìˆ˜ ì¦ê°€ (ìŠ¤í¬ë¦½íŠ¸)

```json
{
  "query": {
    "script_score": {
      "query": {
        "terms": {
          "tags": ["eco", "vegan", "organic"]
        }
      },
      "script": {
        "source": """
          int matches = 0;
          for (tag in params.user_tags) {
            if (doc['tags'].contains(tag)) {
              matches += 1;
            }
          }
          return matches;
        """,
        "params": {
          "user_tags": ["eco", "vegan", "organic"]
        }
      }
    }
  }
}
```

### ### 5-3. íƒœê·¸ ì¼ì¹˜ ìˆ˜ + í‰ì  ì¡°í•© ì ìˆ˜

```json
{
  "query": {
    "script_score": {
      "query": {
        "terms": {
          "tags": ["eco", "vegan", "organic"]
        }
      },
      "script": {
        "source": """
          int matches = 0;
          for (tag in params.user_tags) {
            if (doc['tags'].contains(tag)) {
              matches += 1;
            }
          }
          return matches * 2 + doc['rating'].value;
        """,
        "params": {
          "user_tags": ["eco", "vegan", "organic"]
        }
      }
    }
  }
}
```


